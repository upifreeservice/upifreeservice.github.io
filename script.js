const isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),scratchCardCover=document.querySelector(".scratch-card-cover"),scratchCardCanvasRender=document.querySelector(".scratch-card-canvas-render"),scratchCardCoverContainer=document.querySelector(".scratch-card-cover-container"),scratchCardText=document.querySelector(".scratch-card-text"),scratchCardImage=document.querySelector(".scratch-card-image"),canvas=document.querySelector("canvas"),context=canvas.getContext("2d");let positionX,positionY,isPointerDown=!1,clearDetectionTimeout=null;const devicePixelRatio=window.devicePixelRatio||1,canvasWidth=canvas.offsetWidth*devicePixelRatio,canvasHeight=canvas.offsetHeight*devicePixelRatio;canvas.width=canvasWidth,canvas.height=canvasHeight,context.scale(devicePixelRatio,devicePixelRatio),isSafari&&canvas.classList.add("hidden"),canvas.addEventListener("pointerdown",(e=>{scratchCardCover.classList.remove("shine"),({x:positionX,y:positionY}=getPosition(e)),clearTimeout(clearDetectionTimeout),canvas.addEventListener("pointermove",plot),window.addEventListener("pointerup",(e=>{canvas.removeEventListener("pointermove",plot),clearDetectionTimeout=setTimeout((()=>{checkBlackFillPercentage()}),500)}),{once:!0})}));const checkBlackFillPercentage=()=>{const e=context.getImageData(0,0,canvasWidth,canvasHeight).data;let t=0;for(let a=0;a<e.length;a+=4){const n=e[a],r=e[a+1],i=e[a+2],c=e[a+3];0===n&&0===r&&0===i&&255===c&&t++}100*t/(canvasWidth*canvasHeight)>=45&&(scratchCardCoverContainer.classList.add("clear"),confetti({particleCount:100,spread:90,origin:{y:(scratchCardText.getBoundingClientRect().bottom+60)/window.innerHeight}}),scratchCardText.innerHTML='<button id="claim-button" onclick="makePayment()">Make UPI Payment</button><p id="randomAmount"></p>',scratchCardImage.classList.add("animate"),scratchCardCoverContainer.addEventListener("transitionend",(()=>{scratchCardCoverContainer.classList.add("hidden")}),{once:!0}))},getPosition=({clientX:e,clientY:t})=>{const{left:a,top:n}=canvas.getBoundingClientRect();return{x:e-a,y:t-n}},plotLine=(e,t,a,n,r)=>{for(var i,c,o,s=Math.abs(n-t),d=Math.abs(r-a),l=Math.sqrt(s*s+d*d),u=l/50,v=0;v<l;)c=t+(n-t)*(i=Math.min(1,v/l)),o=a+(r-a)*i,e.beginPath(),e.arc(c,o,16,0,2*Math.PI),e.fill(),v+=u},setImageFromCanvas=()=>{canvas.toBlob((e=>{const t=URL.createObjectURL(e);previousUrl=scratchCardCanvasRender.src,scratchCardCanvasRender.src=t,previousUrl?URL.revokeObjectURL(previousUrl):scratchCardCanvasRender.classList.remove("hidden"),previousUrl=t}))};let setImageTimeout=null;const plot=e=>{const{x:t,y:a}=getPosition(e);plotLine(context,positionX,positionY,t,a),positionX=t,positionY=a,isSafari&&(clearTimeout(setImageTimeout),setImageTimeout=setTimeout((()=>{setImageFromCanvas()}),5))};let currentIndex=0,startX=0,isDragging=!1;const slider=document.querySelector(".slider"),indicatorsContainer=document.querySelector(".indicators");function createIndicators(){const e=document.querySelectorAll(".slider img").length;for(let t=0;t<e;t++){const e=document.createElement("div");e.classList.add("indicator"),e.addEventListener("click",(()=>goToSlide(t))),indicatorsContainer.appendChild(e)}updateIndicators()}function goToSlide(e){currentIndex=e,showSlide(),updateIndicators(),resetTimer()}function showNextSlide(){currentIndex=(currentIndex+1)%document.querySelectorAll(".slider img").length,showSlide(),updateIndicators()}function showSlide(){slider.style.transform=`translateX(${100*-currentIndex}%)`}function updateIndicators(){document.querySelectorAll(".indicator").forEach(((e,t)=>{e.classList.toggle("active",t===currentIndex)}))}function resetTimer(){clearInterval(slideInterval),slideInterval=setInterval(showNextSlide,3e3)}createIndicators();let slideInterval=setInterval(showNextSlide,3e3);function handleDragStart(e){startX=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,isDragging=!0}function handleDragMove(e){if(!isDragging)return;const t=(e.type.startsWith("touch")?e.touches[0].clientX:e.clientX)-startX;Math.abs(t)>50&&(currentIndex=t>0?Math.max(0,currentIndex-1):Math.min(document.querySelectorAll(".slider img").length-1,currentIndex+1),showSlide(),updateIndicators(),resetTimer(),isDragging=!1)}function handleDragEnd(){isDragging=!1}slider.addEventListener("mouseenter",(()=>clearInterval(slideInterval))),slider.addEventListener("mouseleave",resetTimer),slider.addEventListener("mousedown",handleDragStart),slider.addEventListener("mousemove",handleDragMove),slider.addEventListener("mouseup",handleDragEnd),slider.addEventListener("touchstart",handleDragStart),slider.addEventListener("touchmove",handleDragMove),slider.addEventListener("touchend",handleDragEnd);